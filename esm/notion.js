import{Client as e}from"@notionhq/client";let t=t=>new e(t),a=async(e,t)=>{try{return await e.databases.create(t)}catch(e){throw console.error("데이터베이스 생성 실패:",e),e}},r=async(e,t,a="normal")=>{try{let r=await e.databases.retrieve({database_id:t.replace(/^\//,"")}),i=await e.databases.query({database_id:t.replace(/^\//,""),page_size:100});if("flatten"===a){let e={id:r.id};if("title"in r&&(e.title=r.title[0]?.plain_text||""),e.created_time=r.created_time,e.last_edited_time=r.last_edited_time,e.url=r.url,"parent"in r&&"page_id"===r.parent.type&&(e.parent_id=r.parent.page_id,e.parent_type=r.parent.type),"created_by"in r&&(e.created_by=r.created_by.id),"last_edited_by"in r&&(e.last_edited_by=r.last_edited_by.id),i.results.length>0){let t=i.results[0];if("properties"in t){let a=p(t.properties);Object.assign(e,a)}}return e}return{metadata:r,results:i.results}}catch(e){throw console.error("데이터베이스 조회 실패:",e),e}},i=async(e,t)=>{try{return await e.databases.update(t)}catch(e){throw console.error("데이터베이스 업데이트 실패:",e),e}},s=async(e,t)=>{try{return await e.pages.create(t)}catch(e){throw console.error("페이지 생성 실패:",e),e}},l=async(e,t)=>{try{return await e.pages.retrieve({page_id:t})}catch(e){throw console.error("페이지 조회 실패:",e),e}},c=async(e,t)=>{try{return await e.pages.update(t)}catch(e){throw console.error("페이지 업데이트 실패:",e),e}},o=async(e,t)=>{try{return await e.blocks.retrieve({block_id:t})}catch(e){throw console.error("블록 조회 실패:",e),e}},n=async(e,t)=>{try{return await e.blocks.update(t)}catch(e){throw console.error("블록 업데이트 실패:",e),e}},d=async(e,t)=>{try{return await e.blocks.delete({block_id:t})}catch(e){throw console.error("블록 삭제 실패:",e),e}},p=(e,t=!1)=>{let a={};return Object.entries(e).forEach(([e,r])=>{if(!r||!r.type){a[e]="";return}if(t){switch(r.type){case"title":a[e]="title";break;case"rich_text":a[e]="rich_text";break;case"select":a[e]=Array.isArray(r.select.options)?r.select.options.map(e=>e.name).join(", "):"";break;case"multi_select":a[e]=Array.isArray(r.multi_select.options)?r.multi_select.options.map(e=>e.name).join(", "):"";break;case"relation":a[e]=r.relation.database_id||"";break;case"rollup":a[e]=r.rollup.function||"";break;case"formula":a[e]=r.formula.expression||"";break;case"dual_property":a[e]=r.dual_property.database_id||"";break;default:a[e]=r.type||""}return}switch(r.type){case"rich_text":a[e]=r.rich_text?.[0]?.plain_text||"";break;case"title":a[e]=r.title?.[0]?.plain_text||"";break;case"select":a[e]=r.select?.name||"";break;case"multi_select":a[e]=r.multi_select?.map(e=>e.name).join(", ")||"";break;case"number":a[e]=r.number??0;break;case"checkbox":a[e]=r.checkbox??!1;break;case"date":a[e]=r.date?.start||"";break;case"email":a[e]=r.email||"";break;case"phone_number":a[e]=r.phone_number||"";break;case"url":a[e]=r.url||"";break;case"files":a[e]=Array.isArray(r.files)?r.files.map(e=>e.name).join(", "):"";break;case"relation":a[e]=Array.isArray(r.relation)?r.relation.map(e=>e.id).join(", "):r.relation?.id||"";break;case"formula":a[e]=r.formula?.string||r.formula?.number?.toString()||r.formula?.boolean?.toString()||"";break;case"rollup":a[e]=Array.isArray(r.rollup?.array)?r.rollup.array.map(e=>e.title?.[0]?.plain_text||"").join(", "):"";break;case"people":a[e]=Array.isArray(r.people)?r.people.map(e=>e.name||e.id).join(", "):"";break;case"status":a[e]=r.status?.name||"";break;case"created_time":a[e]=r.created_time||"";break;case"created_by":a[e]=r.created_by?.name||r.created_by?.id||"";break;case"last_edited_time":a[e]=r.last_edited_time||"";break;case"last_edited_by":a[e]=r.last_edited_by?.name||r.last_edited_by?.id||"";break;default:a[e]=""}}),a},b=async(e,t="normal")=>{try{let a=await e.search({filter:{property:"object",value:"database"},page_size:100});if("flatten"===t)return a.results.map(e=>{let t={id:e.id,title:e.title?.[0]?.plain_text||"",created_time:e.created_time,last_edited_time:e.last_edited_time,url:e.url,properties:{}};return e.properties&&Object.entries(e.properties).forEach(([e,a])=>{t.properties[e]={id:a.id,name:e,type:a.type}}),t});return a.results}catch(e){throw console.error("데이터베이스 목록 조회 실패:",e),e}};export{t as createNotionClient,a as createDatabase,r as retrieveDatabase,i as updateDatabase,s as createPage,l as retrievePage,c as updatePage,o as retrieveBlock,n as updateBlock,d as deleteBlock,p as flatten,b as listDatabases};