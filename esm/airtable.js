import e from"airtable";let i=null,a=a=>i=new e({apiKey:a.apiKey}).base(a.baseId),t=()=>{if(!i)throw Error("Airtable base is not initialized");return i},l=async(e,i={})=>{let a=[],l=t()(e);return await l.select({view:i.view,maxRecords:i.maxRecords,pageSize:i.pageSize,sort:i.sort,filterByFormula:i.filterByFormula,fields:i.fields}).eachPage((e,i)=>{a.push(...e.map(e=>({id:e.id,fields:e.fields}))),i()}),a},r=async(e,i)=>{let a=await t()(e).find(i);return{id:a.id,fields:a.fields}},s=async(e,i)=>{let a=t()(e),l=Array.isArray(i)?i:[i],r=[];for(let e=0;e<l.length;e+=10)r.push(l.slice(e,e+10));let s=[];for(let e of r){let i=await a.create(e.map(e=>({fields:e.fields})));s.push(...i.map(e=>({id:e.id,fields:e.fields})))}return s},d=async(e,i)=>{let a=t()(e),l=Array.isArray(i)?i:[i],r=[];for(let e=0;e<l.length;e+=10)r.push(l.slice(e,e+10));let s=[];for(let e of r){let i=e.map(e=>({id:e.id,fields:e.fields})),t=await a.update(i);s.push(...t.map(e=>({id:e.id,fields:e.fields})))}return s},f=async(e,i)=>{let a=t()(e),l=Array.isArray(i)?i:[i],r=[];for(let e=0;e<l.length;e+=10)r.push(l.slice(e,e+10));let s=[];for(let e of r){let i=await a.destroy(e);s.push(...i.map(e=>({id:e.id,fields:e.fields})))}return s},n=async(e,i,a)=>{let t=Array.isArray(i)?i:[i],r=t.map(e=>`{${String(a)}} = '${e.fields[a]}'`),f=`OR(${r.join(",")})`,n=new Map((await l(e,{filterByFormula:f})).map(e=>[e.fields[a],e])),p=[],o=[];for(let e of t){let i=n.get(e.fields[a]);i?p.push({id:i.id,fields:{...e.fields}}):o.push({fields:e.fields})}return[...p.length>0?await d(e,p):[],...o.length>0?await s(e,o):[]]},p=async(e,i)=>{t()(e);let a=Array.isArray(i)?i:[i],r=await l(e);return r.length>0&&await f(e,r.map(e=>e.id)),await s(e,a)};export{a as initAirtable,t as getBase,l as selectAll,r as selectOne,s as insert,d as update,f as remove,n as upsert,p as replace};