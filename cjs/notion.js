"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(exports,{createDatabase:function(){return r},createNotionClient:function(){return t},createPage:function(){return n},deleteBlock:function(){return u},flatten:function(){return d},retrieveBlock:function(){return o},retrieveDatabase:function(){return a},retrievePage:function(){return c},updateBlock:function(){return l},updateDatabase:function(){return i},updatePage:function(){return s}});const e=require("@notionhq/client"),t=t=>new e.Client(t),r=async(e,t)=>{try{return await e.databases.create(t)}catch(e){throw console.error("데이터베이스 생성 실패:",e),e}},a=async(e,t,r="normal")=>{try{let a=await e.databases.retrieve({database_id:t.replace(/^\//,"")}),i=await e.databases.query({database_id:t.replace(/^\//,""),page_size:100});if("flatten"===r){let e={id:a.id};if("title"in a&&(e.title=a.title[0]?.plain_text||""),e.created_time=a.created_time,e.last_edited_time=a.last_edited_time,e.url=a.url,"parent"in a&&"page_id"===a.parent.type&&(e.parent_id=a.parent.page_id,e.parent_type=a.parent.type),"created_by"in a&&(e.created_by=a.created_by.id),"last_edited_by"in a&&(e.last_edited_by=a.last_edited_by.id),i.results.length>0){let t=i.results[0];if("properties"in t){let r=d(t.properties);Object.assign(e,r)}}return e}return{metadata:a,results:i.results}}catch(e){throw console.error("데이터베이스 조회 실패:",e),e}},i=async(e,t)=>{try{return await e.databases.update(t)}catch(e){throw console.error("데이터베이스 업데이트 실패:",e),e}},n=async(e,t)=>{try{return await e.pages.create(t)}catch(e){throw console.error("페이지 생성 실패:",e),e}},c=async(e,t)=>{try{return await e.pages.retrieve({page_id:t})}catch(e){throw console.error("페이지 조회 실패:",e),e}},s=async(e,t)=>{try{return await e.pages.update(t)}catch(e){throw console.error("페이지 업데이트 실패:",e),e}},o=async(e,t)=>{try{return await e.blocks.retrieve({block_id:t})}catch(e){throw console.error("블록 조회 실패:",e),e}},l=async(e,t)=>{try{return await e.blocks.update(t)}catch(e){throw console.error("블록 업데이트 실패:",e),e}},u=async(e,t)=>{try{return await e.blocks.delete({block_id:t})}catch(e){throw console.error("블록 삭제 실패:",e),e}},d=(e,t=!1)=>{let r={};return Object.entries(e).forEach(([e,a])=>{if(!a||!a.type){r[e]="";return}if(t){switch(a.type){case"title":r[e]="title";break;case"rich_text":r[e]="rich_text";break;case"select":r[e]=Array.isArray(a.select.options)?a.select.options.map(e=>e.name).join(", "):"";break;case"multi_select":r[e]=Array.isArray(a.multi_select.options)?a.multi_select.options.map(e=>e.name).join(", "):"";break;case"relation":r[e]=a.relation.database_id||"";break;case"rollup":r[e]=a.rollup.function||"";break;case"formula":r[e]=a.formula.expression||"";break;case"dual_property":r[e]=a.dual_property.database_id||"";break;default:r[e]=a.type||""}return}switch(a.type){case"rich_text":r[e]=a.rich_text?.[0]?.plain_text||"";break;case"title":r[e]=a.title?.[0]?.plain_text||"";break;case"select":r[e]=a.select?.name||"";break;case"multi_select":r[e]=a.multi_select?.map(e=>e.name).join(", ")||"";break;case"number":r[e]=a.number??0;break;case"checkbox":r[e]=a.checkbox??!1;break;case"date":r[e]=a.date?.start||"";break;case"email":r[e]=a.email||"";break;case"phone_number":r[e]=a.phone_number||"";break;case"url":r[e]=a.url||"";break;case"files":r[e]=Array.isArray(a.files)?a.files.map(e=>e.name).join(", "):"";break;case"relation":r[e]=Array.isArray(a.relation)?a.relation.map(e=>e.id).join(", "):a.relation?.id||"";break;case"formula":r[e]=a.formula?.string||a.formula?.number?.toString()||a.formula?.boolean?.toString()||"";break;case"rollup":r[e]=Array.isArray(a.rollup?.array)?a.rollup.array.map(e=>e.title?.[0]?.plain_text||"").join(", "):"";break;case"people":r[e]=Array.isArray(a.people)?a.people.map(e=>e.name||e.id).join(", "):"";break;case"status":r[e]=a.status?.name||"";break;case"created_time":r[e]=a.created_time||"";break;case"created_by":r[e]=a.created_by?.name||a.created_by?.id||"";break;case"last_edited_time":r[e]=a.last_edited_time||"";break;case"last_edited_by":r[e]=a.last_edited_by?.name||a.last_edited_by?.id||"";break;default:r[e]=""}}),r};